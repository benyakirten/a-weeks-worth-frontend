(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[681],{5681:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TheWeekModule:()=>ie});var i=n(8583),o=n(4466),r=n(5666),a=n(3018),s=n(8002),l=n(2479),c=n(8797),u=n(5788),d=n(2854),p=n(4697);let m=(()=>{class e{constructor(e){this.apollo=e}get allMyInfo(){return this.apollo.watchQuery({query:c.c2}).valueChanges}updateWeekForIndividual(e,t){return this.apollo.mutate({mutation:u.DP,variables:{shoppingList:e,meals:t},update:(e,{data:t,errors:n})=>{if(n)throw Error(`Unable to update individual: ${n[0].message}`);if(t){const n=e.readQuery({query:c.c2});if(n){const i=Object.assign(Object.assign({},n),{me:Object.assign(Object.assign({},n.me),{individual:Object.assign(Object.assign({},n.me.individual),{shoppingList:t.updateIndividual.individual.shoppingList,meals:t.updateIndividual.individual.meals})})});e.writeQuery({query:c.c2,data:i})}}}})}updateWeekForGroup(e,t,n){return this.apollo.mutate({mutation:d.QO,variables:{id:e,shoppingList:t,meals:n}})}}return e.\u0275fac=function(t){return new(t||e)(a.LFG(p._M))},e.\u0275prov=a.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var g=n(9150),h=n(4097),_=n(8424),f=n(665);function y(e,t){1&e&&a._UZ(0,"app-loading")}function w(e,t){if(1&e&&(a.TgZ(0,"option",8),a._uU(1),a.qZA()),2&e){const e=t.$implicit;a.Q6J("value",e.id),a.xp6(1),a.hij(" ",e.name," ")}}function Z(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"select",4),a.NdJ("change",function(t){return a.CHM(e),a.oxw().changeGroup(t)}),a.TgZ(1,"option",5),a._uU(2,"Choose week to view"),a.qZA(),a.TgZ(3,"option",6),a._uU(4),a.qZA(),a.YNc(5,w,2,2,"option",7),a.qZA()}if(2&e){const e=a.oxw();a.xp6(4),a.hij("",e.username,"'s week"),a.xp6(1),a.Q6J("ngForOf",e.groupsSummary)}}let q=(()=>{class e{constructor(e,t,n,i){this.store=e,this.weekService=t,this.modalService=n,this.router=i,this.loading=!0,this.modalId="the-week-dropdown-modal",this.modalTitle="Something went wrong",this.modalText="\n    Please try to load this page again,\n    either by refreshing the page or navigate away\n    then back here again\n  ",this.modalTop=0,this.groupsSummary=[]}setModalTop(){this.modalTop=window.scrollY}ngOnInit(){this.querySubscription=this.weekService.allMyInfo.subscribe(({data:e,errors:t,loading:n})=>{if(this.loading=n,t)return this.modalText=`\n            There was an error retrieving information -- ${t[0].message}.\n            Please refresh the page or navigate away then back. If the problem persists,\n            contact Ben and let him know what went wrong.\n          `,void this.showModal();this.groupsSummary=e.me.individual.groups.map(e=>({id:e.id,name:e.name}))}),this.storeSubscription=this.store.select("auth").pipe((0,s.U)(e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.username})).subscribe(e=>this.username=e)}changeGroup(e){this.router.navigate(e.target.value?["the-week",e.target.value]:["the-week"])}showModal(){this.modalService.open(this.modalId)}closeModal(){this.modalService.close(this.modalId)}ngOnDestroy(){var e,t;null===(e=this.querySubscription)||void 0===e||e.unsubscribe(),null===(t=this.storeSubscription)||void 0===t||t.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(l.yh),a.Y36(m),a.Y36(g.Z),a.Y36(r.F0))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-week-dropdown"]],hostBindings:function(e,t){1&e&&a.NdJ("scroll",function(){return t.setModalTop()},!1,a.Jf7)},decls:6,vars:6,consts:[[1,"container"],[4,"ngIf"],[3,"change",4,"ngIf"],[3,"id","title","text","top","close"],[3,"change"],["value",""],["value","my-week"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0),a.TgZ(1,"h3"),a._uU(2,"Choose a group"),a.qZA(),a.YNc(3,y,1,0,"app-loading",1),a.YNc(4,Z,6,2,"select",2),a.qZA(),a.TgZ(5,"app-default-modal",3),a.NdJ("close",function(){return t.closeModal()}),a.qZA()),2&e&&(a.xp6(3),a.Q6J("ngIf",t.loading),a.xp6(1),a.Q6J("ngIf",!t.loading),a.xp6(1),a.Q6J("id",t.modalId)("title",t.modalTitle)("text",t.modalText)("top",t.modalTop))},directives:[i.O5,h.r,_.N,f.YN,f.Kr,i.sg],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:baseline}@media only screen and (max-width:56.25em){.container[_ngcontent-%COMP%]{flex-direction:column}}.container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-right:2rem}@media only screen and (max-width:56.25em){.container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:2rem 0}}.container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{font-size:1.8rem;padding:2rem 1rem;width:20rem}@media only screen and (max-width:56.25em){.container[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin-bottom:2rem}}"]}),e})(),v=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-the-week"]],decls:8,vars:0,consts:[[1,"container"],[1,"title"],[1,"content"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0),a.TgZ(1,"div",1),a.TgZ(2,"h1"),a._uU(3,"The Week"),a.qZA(),a._UZ(4,"app-week-dropdown"),a._UZ(5,"div"),a.qZA(),a.TgZ(6,"div",2),a._UZ(7,"router-outlet"),a.qZA(),a.qZA())},directives:[q,r.lC],styles:[".title[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid #212529;margin:2rem 0}@media only screen and (max-width:56.25em){.title[_ngcontent-%COMP%]{flex-direction:column}}"]}),e})();var b=n(3342),x=n(1706);let M=(()=>{class e{constructor(e,t){this.authService=e,this.router=t}canActivate(e,t){return this.authService.isLoggedIn.pipe((0,b.b)(e=>{e||this.router.navigate(["/auth"],{queryParams:{returnUrl:t.url}})}))}canActivateChild(e,t){return this.authService.isLoggedIn.pipe((0,b.b)(e=>{e||this.router.navigate(["/auth"],{queryParams:{returnUrl:t.url}})}))}}return e.\u0275fac=function(t){return new(t||e)(a.LFG(x.e),a.LFG(r.F0))},e.\u0275prov=a.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),O=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-week-blank"]],decls:2,vars:0,template:function(e,t){1&e&&(a.TgZ(0,"h3"),a._uU(1," No group has been selected yet. Please select one from the dropdown menu or look at your own week's plans. "),a.qZA())},styles:["h3[_ngcontent-%COMP%]{width:60%;margin:0 auto}"]}),e})();var T=(()=>(function(e){e.MON="Monday",e.TUE="Tuesday",e.WED="Wednesday",e.THU="Thursday",e.FRI="Friday",e.SAT="Saturday",e.SUN="Sunday"}(T||(T={})),T))(),C=(()=>(function(e){e.B="Breakfast",e.L="Lunch",e.D="Dinner",e.O="Other"}(C||(C={})),C))(),k=n(42),A=n(7611);function P(e,t){if(1&e&&(a.TgZ(0,"app-error-display"),a._uU(1),a.qZA()),2&e){const e=a.oxw();a.xp6(1),a.hij(" ",e.error," ")}}function I(e,t){if(1&e&&(a.TgZ(0,"li"),a.TgZ(1,"p"),a._uU(2),a.qZA(),a.qZA()),2&e){const e=t.$implicit;a.xp6(2),a.lnq("",e.quantity," ",e.unit," of ",e.name,"")}}function N(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"button",16),a.NdJ("click",function(){const t=a.CHM(e).$implicit;return a.oxw().setDayFilter(t)}),a._uU(1),a.qZA()}if(2&e){const e=t.$implicit,n=a.oxw();a.ekj("active",n.dayFilter===e),a.xp6(1),a.hij(" ",n.weekday(e)," ")}}const U=function(e){return["/recipes",e]};function S(e,t){if(1&e&&(a.TgZ(0,"div"),a.TgZ(1,"span"),a._uU(2,"Recipe:\xa0 "),a.TgZ(3,"a",18),a._uU(4),a.qZA(),a.qZA(),a.qZA()),2&e){const e=a.oxw().$implicit;a.xp6(3),a.Q6J("routerLink",a.VKq(2,U,e.recipe.id)),a.xp6(1),a.hij(" ",e.recipe.name," ")}}function F(e,t){if(1&e&&(a.TgZ(0,"div"),a.TgZ(1,"span"),a._uU(2),a.qZA(),a.qZA()),2&e){const e=a.oxw().$implicit;a.xp6(2),a.hij(" Direction: ",e.text," ")}}function J(e,t){if(1&e&&(a.TgZ(0,"li"),a.TgZ(1,"h5"),a._uU(2),a.qZA(),a.YNc(3,S,5,4,"div",1),a.YNc(4,F,3,1,"div",1),a.qZA()),2&e){const e=t.$implicit,n=a.oxw(2);a.xp6(2),a.hij("Meal for ",n.mealtime(e.time),":"),a.xp6(1),a.Q6J("ngIf",e.recipe),a.xp6(1),a.Q6J("ngIf",e.text)}}function L(e,t){if(1&e&&(a.TgZ(0,"div",17),a.TgZ(1,"ul"),a.YNc(2,J,5,3,"li",7),a.qZA(),a.qZA()),2&e){const e=a.oxw();a.xp6(2),a.Q6J("ngForOf",e.filteredMeals)}}function Q(e,t){if(1&e&&(a.TgZ(0,"div",19),a.TgZ(1,"h4"),a._uU(2),a.qZA(),a.qZA()),2&e){const e=a.oxw();a.xp6(2),a.hij("No meals for ",e.weekday(e.dayFilter),"")}}let Y=(()=>{class e{constructor(e,t,n,i){this.route=e,this.router=t,this.modalService=n,this.weekService=i,this.loading=!0,this.meals=[],this.dayFilter="MON",this.shoppingList=[],this.modalId="the-week-detail-modal",this.modalTitle="Something went wrong",this.modalText="\n    Unable to load recipe.\n    Please check the URL and try again.\n    If the problem persists, tell Ben about your problem.\n  ",this.modalTop=0}setModalTop(){this.modalTop=window.scrollY}ngOnInit(){this.route.params.subscribe(e=>{var t;if(!e.id)return this.modalText="\n            Unable to load recipe.\n            Please check the URL and try again.\n            If the problem persists, tell Ben about your problem.\n          ",void this.showModal();this.groupId=e.id,null===(t=this.querySubscription)||void 0===t||t.unsubscribe(),this.querySubscription=this.weekService.allMyInfo.subscribe(({data:t,errors:n,loading:i})=>{if(this.loading=i,n)this.error=n[0].message;else if(this.error=void 0,"my-week"===e.id)this.name="My Week",this.meals=t.me.individual.meals,this.shoppingList=t.me.individual.shoppingList;else{const n=t.me.individual.groups.find(t=>t.id===e.id);if(!n)return this.modalText="\n                    Unable to locate group based on ID.\n                    Please check the URL and try again.\n                  ",void this.showModal();this.name=n.name,this.meals=n.meals,this.shoppingList=n.shoppingList}})})}get weekdayKey(){return Object.keys(T)}weekday(e){return T[e]}mealtime(e){return C[e]}editWeek(){this.router.navigate(["the-week","edit",this.groupId])}setDayFilter(e){this.dayFilter=e}get filteredMeals(){return this.meals.filter(e=>e.day===this.dayFilter)}showModal(){this.modalService.open(this.modalId)}closeModal(){this.modalService.close(this.modalId),this.router.navigate(["the-week"])}ngOnDestroy(){var e;null===(e=this.querySubscription)||void 0===e||e.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(r.gz),a.Y36(r.F0),a.Y36(g.Z),a.Y36(m))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-week-detail"]],hostBindings:function(e,t){1&e&&a.NdJ("scroll",function(){return t.setModalTop()},!1,a.Jf7)},decls:25,vars:11,consts:[[1,"container"],[4,"ngIf"],[1,"name"],[1,"name__display"],[1,"title__button"],["width","10rem",3,"disabled","click"],[1,"shopping-list"],[4,"ngFor","ngForOf"],[1,"meals"],[1,"form-title"],[1,"mode-buttons"],[3,"active","click",4,"ngFor","ngForOf"],[1,"meals__content"],["class","meals__content__day",4,"ngIf","ngIfElse"],["noFilteredMeals",""],[3,"id","title","text","top","close"],[3,"click"],[1,"meals__content__day"],[3,"routerLink"],[1,"meals__content__no-meal"]],template:function(e,t){if(1&e&&(a.TgZ(0,"div",0),a.YNc(1,P,2,1,"app-error-display",1),a.TgZ(2,"div",2),a.TgZ(3,"div",3),a.TgZ(4,"h3"),a._uU(5),a.qZA(),a.qZA(),a.TgZ(6,"div",4),a.TgZ(7,"app-button",5),a.NdJ("click",function(){return t.editWeek()}),a._uU(8," Edit "),a.qZA(),a.qZA(),a.qZA(),a.TgZ(9,"div",6),a.TgZ(10,"h5"),a._uU(11,"Shopping List"),a.qZA(),a.TgZ(12,"ul"),a.YNc(13,I,3,3,"li",7),a.qZA(),a.qZA(),a.TgZ(14,"div",8),a.TgZ(15,"div",9),a.TgZ(16,"h2"),a._uU(17,"See meals by day"),a.qZA(),a.TgZ(18,"div",10),a.YNc(19,N,2,3,"button",11),a.qZA(),a.qZA(),a.TgZ(20,"div",12),a.YNc(21,L,3,1,"div",13),a.YNc(22,Q,3,1,"ng-template",null,14,a.W1O),a.qZA(),a.qZA(),a.qZA(),a.TgZ(24,"app-default-modal",15),a.NdJ("close",function(){return t.closeModal()}),a.qZA()),2&e){const e=a.MAs(23);a.xp6(1),a.Q6J("ngIf",t.error),a.xp6(4),a.Oqu(t.name),a.xp6(2),a.Q6J("disabled",!t.name),a.xp6(6),a.Q6J("ngForOf",t.shoppingList),a.xp6(6),a.Q6J("ngForOf",t.weekdayKey),a.xp6(2),a.Q6J("ngIf",t.filteredMeals.length>0)("ngIfElse",e),a.xp6(3),a.Q6J("id",t.modalId)("title",t.modalTitle)("text",t.modalText)("top",t.modalTop)}},directives:[i.O5,k.r,i.sg,h.r,A.n,r.yS],styles:[".container[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{display:flex;align-items:center}.container[_ngcontent-%COMP%]   .name__display[_ngcontent-%COMP%]{margin-right:2rem}.container[_ngcontent-%COMP%]   .shopping-list[_ngcontent-%COMP%]{margin:2rem 1rem}.container[_ngcontent-%COMP%]   .shopping-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-left:2rem;list-style:circle}.container[_ngcontent-%COMP%]   .shopping-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:.5rem 0}.container[_ngcontent-%COMP%]   .meals[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid #000;margin:2rem 1rem}.container[_ngcontent-%COMP%]   .meals[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]   .mode-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column}.container[_ngcontent-%COMP%]   .meals__content[_ngcontent-%COMP%]{margin-left:1rem;background-color:#faf7f5;box-shadow:2px 2px 2px 2px #0006;padding:1rem 2rem}.container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:2rem 0}.container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.8rem}.container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:link, .container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited{text-decoration:none;color:#2d6a4f;opacity:.8;transition:all .4s}.container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:link:hover, .container[_ngcontent-%COMP%]   .meals__content__day[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:visited:hover{text-decoration:underline;opacity:1}"]}),e})();var j=n(3035),W=n(9526);const R=(e,t)=>e.unit in W.xv&&t.unit in W.xv?{quantity:e.quantity*W.xv[e.unit]+t.quantity*W.xv[t.unit],unit:W.PV}:e.unit in W._w&&t.unit in W._w?{quantity:e.quantity*W._w[e.unit]+t.quantity*W._w[t.unit],unit:W.WV}:e.unit in W.ej&&t.unit in W.ej?{quantity:e.quantity*W.ej[e.unit]+t.quantity*W.ej[t.unit],unit:W.eV}:e.unit in W.aY&&t.unit in W.aY?{quantity:e.quantity*W.aY[e.unit]+t.quantity*W.aY[t.unit],unit:W.SW}:void 0,B=e=>{const t=e.match(/^(\d+)\/(\d+)$/);return t?+t[1]/+t[2]:t};var G=n(2258);function z(e,t){if(1&e&&(a.TgZ(0,"app-error-display"),a._uU(1),a.qZA()),2&e){const e=a.oxw();a.xp6(1),a.hij(" ",e.error," ")}}function D(e,t){1&e&&(a.TgZ(0,"div",3),a._UZ(1,"app-loading"),a.qZA())}function E(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"li",25),a.TgZ(1,"div",26),a.TgZ(2,"div",27),a._UZ(3,"input",28),a.TgZ(4,"label",29),a._uU(5,"Name"),a.qZA(),a.qZA(),a.TgZ(6,"div",27),a._UZ(7,"input",30),a.TgZ(8,"label",29),a._uU(9,"Quantity"),a.qZA(),a.qZA(),a.TgZ(10,"div",27),a._UZ(11,"input",31),a.TgZ(12,"label",29),a._uU(13,"Unit"),a.qZA(),a.qZA(),a.TgZ(14,"button",11),a.NdJ("click",function(){const t=a.CHM(e).index;return a.oxw(2).removeShoppingItem(t)}),a._uU(15," Remove Item "),a.qZA(),a.qZA(),a.qZA()}if(2&e){const e=t.index;a.Q6J("formGroupName",e)("@list",void 0),a.xp6(3),a.Q6J("id","shopping-list-name-"+e)("name","shopping-list-name-"+e),a.xp6(1),a.Q6J("for","shopping-list-name-"+e),a.xp6(3),a.Q6J("id","shopping-list-quantity-"+e)("name","shopping-list-quantity-"+e),a.xp6(1),a.Q6J("for","shopping-list-quantity-"+e),a.xp6(3),a.Q6J("id","shopping-list-unit-"+e)("name","shopping-list-unit-"+e),a.xp6(1),a.Q6J("for","shopping-list-unit-"+e)}}function $(e,t){if(1&e&&(a.TgZ(0,"option",42),a._uU(1),a.qZA()),2&e){const e=t.$implicit,n=a.oxw(3);a.Q6J("ngValue",e),a.xp6(1),a.hij(" ",n.weekday(e)," ")}}function K(e,t){if(1&e&&(a.TgZ(0,"option",42),a._uU(1),a.qZA()),2&e){const e=t.$implicit,n=a.oxw(3);a.Q6J("ngValue",e),a.xp6(1),a.hij(" ",n.mealtime(e)," ")}}function V(e,t){if(1&e&&(a.TgZ(0,"option",42),a._uU(1),a.qZA()),2&e){const e=t.$implicit;a.Q6J("ngValue",e.id),a.xp6(1),a.hij(" ",e.name," ")}}function H(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"li",32),a.TgZ(1,"div",33),a.TgZ(2,"div",34),a.TgZ(3,"label",35),a._uU(4,"Day of the week:"),a.qZA(),a.TgZ(5,"select",36),a.YNc(6,$,2,2,"option",37),a.qZA(),a.qZA(),a.TgZ(7,"div",34),a.TgZ(8,"label",38),a._uU(9,"Meal time"),a.qZA(),a.TgZ(10,"select",39),a.YNc(11,K,2,2,"option",37),a.qZA(),a.qZA(),a.TgZ(12,"div",34),a.TgZ(13,"label",40),a._uU(14,"Recipe:"),a.qZA(),a.TgZ(15,"select",41),a.TgZ(16,"option",42),a._uU(17,"Select Recipe (Leave here for no recipe)"),a.qZA(),a.YNc(18,V,2,2,"option",37),a.qZA(),a.qZA(),a.qZA(),a.TgZ(19,"div",33),a.TgZ(20,"div",34),a.TgZ(21,"label",29),a._uU(22,"Meal Instructions:"),a.qZA(),a._UZ(23,"textarea",43),a.qZA(),a.TgZ(24,"div",44),a.TgZ(25,"app-button",45),a.NdJ("click",function(){const t=a.CHM(e).index;return a.oxw(2).removeMeal(t)}),a._uU(26," Remove Meal "),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&e){const e=t.index,n=a.oxw(2);a.Q6J("formGroupName",e)("@list",void 0),a.xp6(5),a.Q6J("id","meal-weekday"+e)("name","meal-weekday"+e),a.xp6(1),a.Q6J("ngForOf",n.weekdayKey),a.xp6(4),a.Q6J("id","meal-time"+e)("name","meal-time"+e),a.xp6(1),a.Q6J("ngForOf",n.timeKey),a.xp6(4),a.Q6J("id","meal-recipe"+e)("name","meal-recipe"+e),a.xp6(1),a.Q6J("ngValue",null),a.xp6(2),a.Q6J("ngForOf",n.recipes),a.xp6(3),a.Q6J("for","meal-text-"+e),a.xp6(2),a.Q6J("id","meal-text-"+e)("value","meal-text-"+e),a.xp6(2),a.Q6J("disabled",n.mutationLoading)}}const X=function(e){return["/the-week",e]};function ee(e,t){if(1&e){const e=a.EpF();a.TgZ(0,"div"),a.TgZ(1,"form",4),a.NdJ("ngSubmit",function(){return a.CHM(e),a.oxw().onSubmit()}),a.TgZ(2,"div",5),a.TgZ(3,"div",6),a.TgZ(4,"h3"),a._uU(5),a.qZA(),a.qZA(),a.qZA(),a.TgZ(6,"section",7),a.TgZ(7,"div",8),a.TgZ(8,"div",9),a.TgZ(9,"h4"),a._uU(10,"Shopping List"),a.qZA(),a.qZA(),a.TgZ(11,"div",10),a.TgZ(12,"app-button",11),a.NdJ("click",function(){return a.CHM(e),a.oxw().addShoppingItem()}),a._uU(13," Add Shopping List Item "),a.qZA(),a.TgZ(14,"app-button",12),a.NdJ("click",function(){return a.CHM(e),a.oxw().addRecipeIngredientsToShoppingList()}),a._uU(15," Add Week's Ingredients to Shopping List "),a.qZA(),a.TgZ(16,"app-button",11),a.NdJ("click",function(){return a.CHM(e),a.oxw().consolidateShoppingList()}),a._uU(17," Consolidate Shopping List "),a.qZA(),a.qZA(),a.qZA(),a.TgZ(18,"ul"),a.YNc(19,E,16,11,"li",13),a.qZA(),a.qZA(),a.TgZ(20,"section",14),a.TgZ(21,"div",15),a.TgZ(22,"h4"),a._uU(23,"Meals"),a.qZA(),a.TgZ(24,"div",16),a.TgZ(25,"app-button",17),a.NdJ("click",function(){return a.CHM(e),a.oxw().addMeal()}),a._uU(26," Add meal "),a.qZA(),a.qZA(),a.qZA(),a.TgZ(27,"div",18),a.TgZ(28,"ul"),a.YNc(29,H,27,16,"li",19),a.qZA(),a.qZA(),a.qZA(),a.TgZ(30,"div",20),a.TgZ(31,"app-button",21),a._uU(32," Submit "),a.qZA(),a.TgZ(33,"app-button",22),a._uU(34," Cancel "),a.qZA(),a.qZA(),a.TgZ(35,"div",23),a.TgZ(36,"app-button",21),a._uU(37," Submit "),a.qZA(),a.TgZ(38,"app-button",24),a._uU(39," Cancel "),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&e){const e=a.oxw();a.xp6(1),a.Q6J("formGroup",e.weekForm),a.xp6(4),a.Oqu(e.name),a.xp6(14),a.Q6J("ngForOf",e.shoppingListControls),a.xp6(6),a.Q6J("disabled",e.mutationLoading),a.xp6(4),a.Q6J("ngForOf",e.mealsControls),a.xp6(2),a.Q6J("disabled",!e.weekForm.valid||!!e.error||e.mutationLoading||!e.daysAndTimesUnique),a.xp6(2),a.Q6J("routerLink",a.VKq(9,X,e.groupId)),a.xp6(3),a.Q6J("disabled",!e.weekForm.valid||!!e.error||e.mutationLoading||!e.daysAndTimesUnique),a.xp6(2),a.Q6J("routerLink",a.VKq(11,X,e.groupId))}}const te=[{path:"",component:v,canActivate:[M],canActivateChild:[M],children:[{path:"",pathMatch:"full",component:O},{path:"edit/:id",component:(()=>{class e{constructor(e,t,n,i,o){this.route=e,this.router=t,this.modalService=n,this.weekService=i,this.recipesService=o,this.loading=!0,this.recipeLoading=!0,this.mutationLoading=!1,this.mealTimesAndDaysUnique=!0,this.meals=[],this.recipes=[],this.shoppingList=[],this.modalId="the-week-form-modal",this.modalTitle="Something went wrong",this.modalText="\n    Unable to load recipe.\n    Please check the URL and try again.\n    If the problem persists, tell Ben about your problem.\n  ",this.modalTop=0}setModalTop(){this.modalTop=window.scrollY}ngOnInit(){this.initForm(),this.route.params.subscribe(e=>{var t;if(!e.id)return this.modalText="\n            Unable to load recipe.\n            Please check the URL and try again.\n            If the problem persists, tell Ben about your problem.\n          ",void this.showModal();this.groupId=e.id,null===(t=this.weekSubscription)||void 0===t||t.unsubscribe(),this.weekSubscription=this.weekService.allMyInfo.subscribe(({data:t,errors:n,loading:i})=>{if(this.loading=i,n)this.error=n[0].message;else{if(this.error=void 0,"my-week"===e.id)this.name="My Week",this.meals=t.me.individual.meals,this.shoppingList=t.me.individual.shoppingList;else{const n=t.me.individual.groups.find(t=>t.id===e.id);if(!n)return this.modalText="\n                    Unable to locate group based on ID.\n                    Please check the URL and try again.\n                  ",void this.showModal();this.name=n.name,this.meals=n.meals,this.shoppingList=n.shoppingList}this.initForm()}})}),this.recipesSubscription=this.recipesService.recipes.subscribe(({data:e,errors:t,loading:n})=>{this.recipeLoading=n,t?this.error=t[0].message:this.recipes=e.recipes})}initForm(){var e;let t=new f.Oe([]),n=new f.Oe([]);if(this.name){for(let e of this.shoppingList)t.push(new f.cw({name:new f.NI(e.name,[f.kI.required]),quantity:new f.NI(e.quantity,[f.kI.required]),unit:new f.NI(e.unit,[f.kI.required])}));for(let t of this.meals)n.push(new f.cw({time:new f.NI(t.time,[f.kI.required]),day:new f.NI(t.day,[f.kI.required]),text:new f.NI(t.text),recipeId:new f.NI(null===(e=t.recipe)||void 0===e?void 0:e.id)}))}this.weekForm=new f.cw({shoppingList:t,meals:n})}addRecipeIngredientsToShoppingList(){const e=this.weekForm.value.meals.map(e=>e.recipeId).filter(e=>!!e);let t=[];for(let n of e){const e=this.recipes.find(e=>e.id===n);if(!e)return;t=t.concat(e.ingredients)}for(let n of t)this.weekForm.get("shoppingList").push(new f.cw({name:new f.NI(n.name,[f.kI.required]),quantity:new f.NI(n.quantity,[f.kI.required]),unit:new f.NI(n.unit,[f.kI.required])}))}consolidateShoppingList(){const e=this.weekForm.controls.shoppingList.value,t=e.map(e=>e.name.toLowerCase());if(new Set(t).size===t.length)return;const n=[],i=[];for(let a of e)if(i.includes(a.name.toLowerCase())){const e=i.indexOf(a.name.toLowerCase().trim()),t={quantity:B(a.quantity.trim())||+a.quantity.trim(),unit:a.unit.toLowerCase().trim()},o={quantity:+n[e].quantity.trim(),unit:n[e].unit.toLowerCase().trim()};if(t.quantity&&o.quantity){const r=R(t,o);r?(n[e].quantity=r.quantity.toString(),n[e].unit=r.unit):t.quantity&&o.quantity&&t.unit.toLowerCase().trim()===o.unit.toLowerCase().trim()?n[e].quantity=(t.quantity+o.quantity).toString():(i.push(a.name.toLowerCase()),n.push(a))}}else i.push(a.name.toLowerCase().trim()),n.push(a);const o=n.map(e=>{const t=(e=>{switch(e.unit){case"milligrams":case"mg":return e.quantity/1e6>0?{unit:"kilograms",quantity:+(e.quantity/1e6).toFixed(2)}:e;case"oz":case"ounces":return e.quantity/16>0?{unit:"pound",quantity:+(e.quantity/16).toFixed(2)}:e;case"ml":case"millileters":return e.quantity/1e3>0?{unit:"liters",quantity:+(e.quantity/16).toFixed(2)}:e;case"tsp":case"teaspoons":return e.quantity/768>0?{unit:"gallons",quantity:+(e.quantity/768).toFixed(2)}:e.quantity/192>0?{unit:"quarts",quantity:+(e.quantity/192).toFixed(2)}:e.quantity/48>0?{unit:"cups",quantity:+(e.quantity/48).toFixed(2)}:e.quantity/6>0?{unit:"fluid ounces",quantity:+(e.quantity/6).toFixed(2)}:e.quantity/3>0?{unit:"tablespoons",quantity:+(e.quantity/3).toFixed(2)}:e;default:return e}})({quantity:+e.quantity,unit:e.unit});return{name:e.name,quantity:t.quantity.toString(),unit:t.unit}}),r=new f.Oe([]);for(let a of o)r.push(new f.cw({name:new f.NI(a.name,[f.kI.required]),quantity:new f.NI(a.quantity,[f.kI.required]),unit:new f.NI(a.unit,[f.kI.required])}));this.weekForm.setControl("shoppingList",r)}get shoppingListControls(){return this.weekForm.get("shoppingList").controls}addShoppingItem(){this.weekForm.get("shoppingList").push(new f.cw({name:new f.NI(null,[f.kI.required]),quantity:new f.NI(null,[f.kI.required]),unit:new f.NI(null,[f.kI.required])}))}removeShoppingItem(e){this.weekForm.get("shoppingList").removeAt(e)}get mealsControls(){return this.weekForm.get("meals").controls}addMeal(){this.weekForm.get("meals").push(new f.cw({time:new f.NI("B",[f.kI.required]),day:new f.NI("MON",[f.kI.required]),text:new f.NI(null),recipeId:new f.NI(null)}))}removeMeal(e){this.weekForm.get("meals").removeAt(e)}get weekdayKey(){return Object.keys(T)}get timeKey(){return Object.keys(C)}weekday(e){return T[e]}mealtime(e){return C[e]}get daysAndTimesUnique(){for(let e of this.weekdayKey){const t=this.weekForm.value.meals.filter(t=>t.day===e).map(e=>e.time);if(t.length!==new Set(t).size)return!1}return!0}onSubmit(){var e,t;if(!this.weekForm.valid||this.error||!this.daysAndTimesUnique)return this.modalTitle="An Error Occurred While Creating The Recipe",this.modalText="\n        The form isn't correct, and we can't proceed. The most likely reason\n        is that the form has empty fields, hasn't been edited, or there are\n        days with overlapping mealtimes. Please check the form and try again.\n      ",void this.showModal();const n=this.weekForm.value.shoppingList,i=this.weekForm.value.meals.map(e=>Object.assign(Object.assign({},e),{time:C[e.time].toUpperCase(),day:T[e.day].toUpperCase()}));console.log(n),console.log(i),"my-week"===this.groupId?(null===(e=this.mutationSubscription)||void 0===e||e.unsubscribe(),this.mutationSubscription=this.weekService.updateWeekForIndividual(n,i).subscribe(({errors:e,data:t})=>{e?this.error=e[0].message:t&&this.router.navigate(["the-week",this.groupId])})):(null===(t=this.mutationSubscription)||void 0===t||t.unsubscribe(),this.mutationSubscription=this.weekService.updateWeekForGroup(this.groupId,n,i).subscribe(({errors:e,data:t})=>{e?this.error=e[0].message:t&&this.router.navigate(["the-week",this.groupId])}))}showModal(){this.modalService.open(this.modalId)}closeModal(){this.modalService.close(this.modalId)}ngOnDestroy(){var e,t,n;null===(e=this.recipesSubscription)||void 0===e||e.unsubscribe(),null===(t=this.weekSubscription)||void 0===t||t.unsubscribe(),null===(n=this.mutationSubscription)||void 0===n||n.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(a.Y36(r.gz),a.Y36(r.F0),a.Y36(g.Z),a.Y36(m),a.Y36(G.v))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-week-form"]],hostBindings:function(e,t){1&e&&a.NdJ("scroll",function(){return t.setModalTop()},!1,a.Jf7)},decls:5,vars:7,consts:[[4,"ngIf"],["class","loading",4,"ngIf"],[3,"id","title","text","top","close"],[1,"loading"],[1,"form",3,"formGroup","ngSubmit"],[1,"name"],[1,"name__display"],["formArrayName","shoppingList",1,"shopping-list"],[1,"shopping-list__head"],[1,"shopping-list__head__title"],[1,"shopping-list__head__add"],["type","button",3,"click"],["type","button","margin","1rem",3,"click"],["class","form__group__controls",3,"formGroupName",4,"ngFor","ngForOf"],["formArrayName","meals",1,"meals"],[1,"meals__title"],[1,"meals__title__buttons"],["type","button","margin","0 2rem",3,"disabled","click"],[1,"meals__content"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"form__buttons"],["type","submit","width","8rem",3,"disabled"],["type","button","width","8rem","margin","2rem 0",3,"routerLink"],[1,"form__submit"],["type","button","width","8rem","margin","0 2rem",3,"routerLink"],[1,"form__group__controls",3,"formGroupName"],[1,"form__group__controls__row"],[1,"control-group"],["type","text","placeholder"," ","formControlName","name",3,"id","name"],[3,"for"],["type","text","placeholder"," ","formControlName","quantity",3,"id","name"],["type","text","placeholder"," ","formControlName","unit",3,"id","name"],[3,"formGroupName"],[1,"meals__row"],[1,"meals__content__control-group"],["for","'meal-weekday' + i"],["formControlName","day",3,"id","name"],[3,"ngValue",4,"ngFor","ngForOf"],["for","'meal-time' + i"],["formControlName","time",3,"id","name"],["for","'meal-recipe' + i"],["formControlName","recipeId",3,"id","name"],[3,"ngValue"],["cols","50","rows","4","placeholder","Turn the oven on to 350 degrees","formControlName","text",3,"id","value"],[1,"meals__content__remove-meal"],["type","button",3,"disabled","click"]],template:function(e,t){1&e&&(a.TgZ(0,"article"),a.YNc(1,z,2,1,"app-error-display",0),a.YNc(2,D,2,0,"div",1),a.YNc(3,ee,40,13,"div",0),a.qZA(),a.TgZ(4,"app-default-modal",2),a.NdJ("close",function(){return t.closeModal()}),a.qZA()),2&e&&(a.xp6(1),a.Q6J("ngIf",t.error),a.xp6(1),a.Q6J("ngIf",!t.error&&t.loading),a.xp6(1),a.Q6J("ngIf",!t.error&&!t.loading),a.xp6(1),a.Q6J("id",t.modalId)("title",t.modalTitle)("text",t.modalText)("top",t.modalTop))},directives:[i.O5,h.r,A.n,_.N,f._Y,f.JL,f.sg,f.CE,k.r,i.sg,r.rH,f.x0,f.Fj,f.JJ,f.u,f.EJ,f.YN,f.Kr],styles:[".name[_ngcontent-%COMP%]{margin-left:1rem}.shopping-list__head[_ngcontent-%COMP%]{display:flex;align-items:center;width:80%;margin-left:1rem;padding:2rem 0}.shopping-list__head__title[_ngcontent-%COMP%]{margin-right:2rem}.form[_ngcontent-%COMP%]{position:relative}.form__buttons[_ngcontent-%COMP%]{position:fixed;top:10rem;right:10rem;display:flex;flex-direction:column}@media only screen and (max-width:56.25em){.form__buttons[_ngcontent-%COMP%]{display:none;visibility:hidden}}.form__group__controls__row[_ngcontent-%COMP%]{display:flex;align-items:center}.form__group__controls__row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:20rem}@media only screen and (max-width:56.25em){.form__group__controls__row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:8rem}}.form__group__controls__row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer;padding:1rem;margin:0 0 1rem 1rem;font-size:2.4rem;border:1px solid #081c15;background-color:#d8f3dc;box-shadow:0 1px 1px 1px #0006;transition:all .4s}.form__group__controls__row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.form__group__controls__row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:translateY(-1px)}section[_ngcontent-%COMP%]{border-bottom:2px solid #212529;margin-bottom:2rem}.shopping-list__head__add[_ngcontent-%COMP%]{display:flex;align-items:center}@media only screen and (max-width:56.25em){.shopping-list__head__add[_ngcontent-%COMP%]{flex-direction:column}}.meals__title[_ngcontent-%COMP%]{display:flex;align-items:center}.meals__row[_ngcontent-%COMP%]{display:flex;margin:2rem 0}.meals__content__control-group[_ngcontent-%COMP%]{margin-right:2rem;display:flex;align-items:center}.meals__content__control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.44rem;margin-right:.5rem}.meals__content__control-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:2px}"],data:{animation:[(0,j.aR)("list")]}}),e})()},{path:":id",component:Y}]}];let ne=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[r.Bz.forChild(te)],r.Bz]}),e})(),ie=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[i.ez,f.UX,ne,o.m]]}),e})()}}]);